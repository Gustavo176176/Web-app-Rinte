<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Relat√≥rio de Consumo ({{ periodo }})</title>
    <style>
        body { font-family: sans-serif; font-size: 10pt; margin: 30px; }
        h1 { color: #2c3e50; border-bottom: 2px solid #ccc; padding-bottom: 5px; }
        h2 { color: #555; margin-top: 20px; font-size: 12pt; }
        .details { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .details th, .details td { text-align: left; padding: 8px; border: 1px solid #ddd; }
        .details th { background-color: #f2f2f2; }
        .alert-excedido { background-color: #fdd; color: #cc0000; font-weight: bold; }
        .alert-ok { background-color: #dfd; color: #008000; }
        .total { font-size: 16pt; font-weight: bold; margin-top: 25px; color: #0d6efd; }
        .mes-titulo { font-size: 14pt; margin-top: 20px; margin-bottom: 5px; color: #2c3e50; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>
    <h1>Relat√≥rio de Consumo - {{ periodo }}</h1>
    <p>Residente: {{ residente.nome }}</p>
    <p>Data de Gera√ß√£o: {{ data_hoje }}</p>

    {% comment %}Relat√≥rio Mensal{% endcomment %}
    {% if tipo_relatorio == 'mensal' %}
        <h2>An√°lise de Or√ßamento e Custos Mensais</h2>
        <table class="details">
            <thead>
                <tr>
                    <th style="width: 30%;">Tipo</th> 
                    <th style="width: 25%;">Limite Or√ßamental (‚Ç¨)</th>
                    <th style="width: 25%;">Custo Calculado (‚Ç¨)</th>
                    <th style="width: 20%;">Status</th>
                </tr>
            </thead>
            <tbody>
                
             

                {% for tipo, dados in alerta_status.items %}
               
                <tr class="{% if dados.status == 'excedido' %}alert-excedido{% else %}alert-ok{% endif %}">
                    <td>
                        {% if tipo == 'Luz' %}‚ö° Luz
                        {% elif tipo == 'Agua' %}üíß √Ågua
                        {% elif tipo == 'Gas' %}üî• G√°s
                        {% else %}{{ tipo }}{% endif %}
                    </td>
                    <td>{{ dados.meta|floatformat:2 }} ‚Ç¨</td>
                    <td>{{ dados.custo|floatformat:2 }} ‚Ç¨</td>
                    <td>
                        {# Verifica se o or√ßamento foi excedido: se sim, exibe a mensagem de alerta; se n√£o, exibe "OK" #}
                        
                        {% if dados.status == 'excedido' %}{{ dados.mensagem }}{% else %}OK{% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

    {% elif tipo_relatorio == 'anual' %}
        <h1>Relat√≥rio Anual Detalhado ({{ ano }})</h1>

        {% for dados_mensais in relatorio_anual_detalhado %}
            <h2 class="mes-titulo">{{ dados_mensais.mes_nome }} {{ dados_mensais.ano }}</h2>
            <table class="details">
                <thead>
                    <tr>
                        <th style="width: 20%;">Tipo</th> 
                        <th style="width: 20%;">Limite Mensal (‚Ç¨)</th>
                        <th style="width: 20%;">Custo Mensal (‚Ç¨)</th>
                        <th style="width: 40%;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for dados_utilidade in dados_mensais.utilidades %}
                    <tr class="{% if dados_utilidade.status == 'excedido' %}alert-excedido{% else %}alert-ok{% endif %}">
                        <td>
                            {% if dados_utilidade.utilidade == 'Luz' %}‚ö° Luz
                            {% elif dados_utilidade.utilidade == 'Agua' %}üíß √Ågua
                            {% elif dados_utilidade.utilidade == 'Gas' %}üî• G√°s
                            {% else %}{{ dados_utilidade.utilidade }}{% endif %}
                        </td>
                        <td>{{ dados_utilidade.meta|floatformat:2 }} ‚Ç¨</td>
                        <td>{{ dados_utilidade.custo|floatformat:2 }} ‚Ç¨</td>
                        <td>{{ dados_utilidade.mensagem }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="2" style="text-align: right; font-weight: bold; background-color: #f2f2f2;">TOTAL MENSAL:</td>
                        <td colspan="2" style="font-weight: bold; background-color: #f2f2f2;">{{ dados_mensais.custo_total_mes|floatformat:2 }} ‚Ç¨</td>
                    </tr>
                </tfoot>
            </table>
            <div style="height: 15px;"></div>
        {% endfor %}
    {% endif %}

    {# Exibe o custo total do per√≠odo com 2 casas decimais #}
    <p class="total" style="border-top: 2px solid #2c3e50; padding-top: 15px;">
        Custo Total Estimado: {{ custo_total|floatformat:2 }} ‚Ç¨
    </p>
</body>
</html>
